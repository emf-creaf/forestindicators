---
title: "Indicator estimation"
author: "Miquel De Cáceres / Núria Aquilué"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Indicator estimation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(forestindicators)
```

## Introduction

In this vignette, you will learn:

  1. How to format your data for indicator estimation.
  2. How to discover which indicator functions are available, their data requirements and additional parameters.
  3. How to perform the estimation of multiple indicators at once.

## Data frame inputs

Data inputs for the estimation of indicators are data frames. Not all indicators require the same inputs, and the data frames can be of four different kinds, depending on:

 - Whether they describe *stand-level* vs. *plant-level* data
 - Whether they contain *static* vs. *dynamic* data
 
The following subsections provide examples of the four different data frames. A single indicator may only need data of one kind (e.g. plant-level dynamic data), but when calculating several indicators at once, one may end-up supplying more than one data frame.

### Stand-level static data

This data frame contains **stand-level** information that **does not change through time**, such as topographic features, the area represented, etc. 

The actual columns will depend on the indicator to be calculated, but at least a column `id_stand` (character) should be defined to identify stands. An example of stand-level static data frame is the following:

```{r}
example_stand_static_input
```

### Stand-level dynamic data

This data frame contains **stand-level** information that **does change through time**, such as temperature, precipitation, the stand leaf area index, canopy cover, etc. 

The actual columns will depend on the indicator to be calculated, but at least columns `id_stand` (character) and `date` (Date) should be defined to identify stands and time points, respectively. An example of stand-level dynamic data frame is the following:

```{r}
example_stand_dynamic_input
```


### Plant-level static data


```{r}
example_plant_static_input
```

### Plant-level dynamic data

```{r}
example_plant_dynamic_input
```


## Indicator functions and parameters

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r}
indicators <- c("timber_harvest", "density_dead_wood")
```

```{r}
additional_parameters[additional_parameters$indicator %in% indicators, ]
```


## Indicator estimation

### Define values for additional parameters

```{r}
params <- list(timber_harvest = list(province = 8),
               density_dead_wood = list(max_tree_dbh = 20))
```

### Estimation function

```{r}
res <- estimate_indicators(indicators,
                           plant_dynamic_input = example_plant_dynamic_input,
                           timber_volume_function = forestindicators:::.ifn_volume_forestindicators,
                           additional_params = params,
                           verbose = TRUE)
```


```{r, echo=FALSE, results='asis'}
knitr::kable(head(res, 10))
```


